<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Creates a file atomically — createFileAtomically • R.utils</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Creates a file atomically — createFileAtomically"><meta property="og:description" content="Creates a file atomically by first creating and writing to a temporary file which
  is then renamed."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">R.utils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.12.0-9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/HenrikBengtsson/R.utils/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Creates a file atomically</h1>
    
    <div class="hidden name"><code>createFileAtomically.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Creates a file atomically by first creating and writing to a temporary file which
  is then renamed.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for default</span></span>
<span><span class="fu">createFileAtomically</span><span class="op">(</span><span class="va">filename</span>, path<span class="op">=</span><span class="cn">NULL</span>, <span class="va">FUN</span>, <span class="va">...</span>, skip<span class="op">=</span><span class="cn">FALSE</span>, overwrite<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>  backup<span class="op">=</span><span class="cn">TRUE</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>filename</dt>
<dd><p>The filename of the file to create.</p></dd>

   <dt>path</dt>
<dd><p>The path to the file.</p></dd>

   <dt>FUN</dt>
<dd><p>A <code><a href="https://rdrr.io/r/base/function.html" class="external-link">function</a></code> that creates and writes to the pathname that
      is passed as the first argument.  This pathname is guaranteed
      to be a non-existing temporary pathname.</p></dd>

   <dt>...</dt>
<dd><p>Additional arguments passed to <code><a href="pushTemporaryFile.html">pushTemporaryFile</a></code>()
      and <code><a href="popTemporaryFile.html">popTemporaryFile</a></code>().</p></dd>

   <dt>skip</dt>
<dd><p>If <code><a href="https://rdrr.io/r/base/logical.html" class="external-link">TRUE</a></code> and a file with the same pathname already exists,
      nothing is done/written.</p></dd>

   <dt>overwrite</dt>
<dd><p>If <code><a href="https://rdrr.io/r/base/logical.html" class="external-link">TRUE</a></code> and a file with the same pathname
      already exists, the existing file is overwritten.
      This is also done atomically such that if the new file was not
      successfully created, the already original file is restored.
      If restoration also failed, the original file remains as
      the pathname with suffix <code>".bak"</code> appended.</p></dd>

   <dt>backup</dt>
<dd><p>If <code><a href="https://rdrr.io/r/base/logical.html" class="external-link">TRUE</a></code> and a file with the same pathname already exists,
      then it is backed up while creating the new file.  If the new file
      was not successfully created, the original file is restored from
      the backup copy.</p></dd>

   <dt>verbose</dt>
<dd><p>A <code><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></code> or <code><a href="Verbose.html">Verbose</a></code>.</p></dd>

 </dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Returns (invisibly) the pathname.</p>
<p></p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Henrik Bengtsson</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Internally,
  <code><a href="pushTemporaryFile.html">pushTemporaryFile</a></code>() and <code><a href="popTemporaryFile.html">popTemporaryFile</a></code>() are used for
  working toward a temporary file, and
  <code><a href="pushBackupFile.html">pushBackupFile</a></code>() and <code><a href="popBackupFile.html">popBackupFile</a></code>() are used for backing up
  and restoring already existing file.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span></span>
<span class="r-in"><span><span class="co"># Create a file atomically</span></span></span>
<span class="r-in"><span><span class="co"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">pathname</span> <span class="op">&lt;-</span> <span class="fu">createFileAtomically</span><span class="op">(</span><span class="st">"foobar.txt"</span>, path<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">pathname</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="Non-documented_objects.html">cat</a></span><span class="op">(</span>file<span class="op">=</span><span class="va">pathname</span>, <span class="st">"This file was created atomically.\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="Non-documented_objects.html">cat</a></span><span class="op">(</span>file<span class="op">=</span><span class="va">pathname</span>, <span class="st">"Timestamp: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span> <span class="op">(</span><span class="va">kk</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="Non-documented_objects.html">cat</a></span><span class="op">(</span>file<span class="op">=</span><span class="va">pathname</span>, <span class="va">kk</span>, <span class="st">"\n"</span>, append<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># Emulate a slow process</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="Non-documented_objects.html">cat</a></span><span class="op">(</span>file<span class="op">=</span><span class="va">pathname</span>, <span class="st">"END OF FILE\n"</span>, append<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">bfr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">pathname</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="Non-documented_objects.html">cat</a></span><span class="op">(</span><span class="va">bfr</span>, sep<span class="op">=</span><span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Timestamp: 2022-10-23 13:27:03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> END OF FILE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span></span>
<span class="r-in"><span><span class="co"># Overwrite the file atomically (emulate write failure)</span></span></span>
<span class="r-in"><span><span class="co"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">pathname</span> <span class="op">&lt;-</span> <span class="fu">createFileAtomically</span><span class="op">(</span><span class="st">"foobar.txt"</span>, path<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">pathname</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="Non-documented_objects.html">cat</a></span><span class="op">(</span>file<span class="op">=</span><span class="va">pathname</span>, <span class="st">"Trying to create a new file.\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="Non-documented_objects.html">cat</a></span><span class="op">(</span>file<span class="op">=</span><span class="va">pathname</span>, <span class="st">"Writing a bit, but then an error...\n"</span>, append<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># Emulate write error</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"An error occured while writing to the new file."</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="Non-documented_objects.html">cat</a></span><span class="op">(</span>file<span class="op">=</span><span class="va">pathname</span>, <span class="st">"END OF FILE\n"</span>, append<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">ex</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ex</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The original file was never overwritten</span></span></span>
<span class="r-in"><span><span class="va">bfr2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">pathname</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="Non-documented_objects.html">cat</a></span><span class="op">(</span><span class="va">bfr2</span>, sep<span class="op">=</span><span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Timestamp: 2022-10-23 13:27:03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> END OF FILE</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">bfr2</span>, <span class="va">bfr</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The partially temporary file remains</span></span></span>
<span class="r-in"><span><span class="va">pathnameT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s.tmp"</span>, <span class="va">pathname</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="isFile.html">isFile</a></span><span class="op">(</span><span class="va">pathnameT</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bfr3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">pathnameT</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="Non-documented_objects.html">cat</a></span><span class="op">(</span><span class="va">bfr3</span>, sep<span class="op">=</span><span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Trying to create a new file.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Writing a bit, but then an error...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="va">pathnameT</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="va">pathname</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Henrik Bengtsson.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6</p> and <a href="https://github.com/HenrikBengtsson/pkgdown.extras/">pkgdown.extras</a> 0.0.0.9005.</p>
</div>

      </footer></div>

  


  

  </body></html>

